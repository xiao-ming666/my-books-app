<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„å…¨æ ˆä¹¦å•</title>
</head>
<body>
    <h1>ğŸ“š AI æ—¶ä»£çš„å…¨æ ˆä¹‹è·¯</h1>
    
    <div>
        <input type="text" id="bookInput" placeholder="è¾“å…¥ä½ æƒ³å­¦ä¹ çš„æŠ€æœ¯...">
        <button onclick="fetchBooks()">æœç´¢</button>
        <button onclick="addBook()">æ·»åŠ åˆ°æ•°æ®åº“</button>
    </div>

    <ul id="bookList"></ul>

    <script>
        // A. è·å–ä¹¦å•å¹¶æ¸²æŸ“
        async function fetchBooks() {
            const input = document.getElementById('bookInput');
            const query = input.value ? `?title=${encodeURIComponent(input.value)}` : '';
            const res = await fetch(`/api/books${query}`);
            const data = await res.json();
            const list = document.getElementById('bookList');
            list.innerHTML = data.map(book => `
                <li>
                    ${book.title} 
                    <small>(${new Date(book.createdAt).toLocaleString()})</small>
                    <button onclick="deleteBook('${book._id}')">åˆ é™¤</button>
                    <button onclick="updateBook('${book._id}','${book.title}')">æ›´æ–°</button>
                </li>
            `).join('');
        }

        // B. æ·»åŠ ä¹¦ç±
        async function addBook() {
            const input = document.getElementById('bookInput');
            // if (!input.value) return alert('è¯·è¾“å…¥å†…å®¹');

            const res = await fetch('/api/books', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: input.value })
            }).catch(err => alert('æ·»åŠ å¤±è´¥: ' + err.message));

            if (res.ok) {
                input.value = ''; // æ¸…ç©º
                fetchBooks();    // åˆ·æ–°åˆ—è¡¨
            }
        }

        async function deleteBook(id) {
            const res = await fetch(`/api/books/${id}`, { method: 'DELETE' });
            if (res.ok) fetchBooks();
        }

        async function updateBook(id, oldTitle) {
            const newTitle = prompt('è¯·è¾“å…¥æ–°çš„ä¹¦å', oldTitle);
            if (!newTitle) return;

            const res = await fetch(`/api/books/${id}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title: newTitle })
    });
            if (res.ok) fetchBooks();
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡
        fetchBooks();
    </script>
</body>
</html>